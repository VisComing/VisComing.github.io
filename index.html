<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="zrf">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/%E5%AE%A0%E7%89%A9%E5%B0%8F%E7%B2%BE%E7%81%B5%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/%E5%AE%A0%E7%89%A9%E5%B0%8F%E7%B2%BE%E7%81%B5%E6%96%87%E6%A1%A3/" class="post-title-link" itemprop="url">宠物小精灵对战系统文档</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 11:31:31 / Modified: 11:31:53" itemprop="dateCreated datePublished" datetime="2020-11-10T11:31:31+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="宠物小精灵对战系统文档"><a href="#宠物小精灵对战系统文档" class="headerlink" title="宠物小精灵对战系统文档"></a>宠物小精灵对战系统文档</h1><h2 id="一、题目要求"><a href="#一、题目要求" class="headerlink" title="一、题目要求"></a>一、题目要求</h2><p><strong>题目一：宠物小精灵的加入</strong></p>
<blockquote>
<p>要求：</p>
<p>设计宠物小精灵的类，为简化游戏设计，精灵的属性包括种类（力量型：高攻击； 肉盾型：高生命值； 防御型：高防御； 敏捷型：低攻击间隔，共四种）、名字、等级、经验值、攻击力、防御力、生命值、攻击间隔等（以上属性必须，其他属性可自行添加）（基本要求：本游戏中只有上面的4种类型。 进一步要求：上述4种类型可以进一步深入划分，比如力量型又可以再细分为：沙瓦朗、火爆猴、腕力等）</p>
<p>每个精灵初始等级为1，满级15级，每当精灵升级的时候，宠物对应的属性值会有少量增加（主属性增加量相对较多）</p>
<p>每个精灵有自己独特的攻击方式，如“闪电攻击”，“火焰攻击”等等，请设计一个精灵的基类，并将精灵的攻击方法设为虚方法以方便子类重写</p>
<p>请写一个测试程序对设计的精灵类的相关属性和方法（包括攻击函数，升级函数等）进行测试</p>
<p>题目主要考察点：类的继承，对象数据成员设计，成员函数设计 </p>
</blockquote>
<p><strong>题目二：用户注册与平台登录</strong></p>
<blockquote>
<p>要求：</p>
<p>每个用户需要注册一个账号，用户名全局唯一，不能有任何两个用户名相同，要考虑注册失败的场景时的反馈</p>
<p>实现注册、登录、登出功能，均采用C/S模式，客户端和服务端用socket进行通信，服务端保存所有用户的信息</p>
<p>每个用户拥有：用户名、拥有的精灵，两个属性。 用户注册成功时，系统自动随机分发三个1级精灵给用户</p>
<p>用户可以查看所有成功注册用户拥有的精灵，也可以查看所有当前在线的用户</p>
<p>题目主要考察点：socket通信，交互场景反馈，用户信息存储方式，界面交互，其它合理的新颖设计。</p>
</blockquote>
<p><strong>题目三：游戏对战的设计</strong></p>
<blockquote>
<p>要求：</p>
<p>已经登录的在线用户可以和服务器进行虚拟决斗，决斗分两种：升级赛和决斗赛，两种比赛都能增长精灵宠物经验值。服务器上有一个虚拟精灵的列表，用户可以挑选其中任意一个进行比赛（升级赛或者决斗赛）。另外决斗赛中用户胜出可以直接获得该战胜的精灵，失败则系统从用户的精灵中随机选三个（不够三个精灵的情况就选择他所有的精灵），然后由用户选一个送出。</p>
<p>升级赛 只是用户用来增加精灵经验值，规则开发者自定；</p>
<p>累积多少经验值升一级，规则开发者自定；</p>
<p>决斗赛的上述规则同升级赛，只是额外还可以赢得一个宠物或失去一个宠物。</p>
<p>用户如果没有精灵（比如总是失败，已经全部送出去），则系统会随机放给他一个初级精灵。</p>
<p>请让你的系统自动模拟每场比赛的每次出招。另外，为了增加不确定性，可以加入概率闪避攻击和暴击伤害机制</p>
<p>比赛的过程和结果由系统根据上述规则自动模拟完成，要求结果具有一定的随机性。</p>
<p>用户增加新功能，可以查看某个用户的胜率</p>
<p>用户增加新属性，为宠物个数徽章（金银铜）和高级宠物徽章（金银铜），分别根据拥有的宠物个数的多少和拥有高级宠物（15级）个数的多少颁发</p>
<p>题目主要考察点：客户端与服务器数据交互（可采用多进程或异步通信或其他方法均可），并发请求处理，类的方法设计，伤害计算方法设计，界面交互，其它合理的新颖设计。</p>
</blockquote>
<p><strong>软件设计要求</strong></p>
<blockquote>
<p>如有必要的友元函数，要在报告（课程设计报告）和程序中说明每个友元函数的不可替代性，为什么一定要用友元才能实现。</p>
<p>自己编写的代码，除主函数和必要的友元函数外，不允许出现任何一个非类成员函数。</p>
<p>任何不改变对象状态（不改写自身对象数据成员值）的成员函数均需显式标注const。</p>
</blockquote>
<p><strong>代码规范性要求</strong></p>
<blockquote>
<p>代码需遵循课件提出的编码规范要求。</p>
<p>通过开发环境自动生成的界面类代码，全部数据成员和成员函数需在类声明时加以注释，函数体内的必要步骤要加以注释。</p>
<p>其他全部类代码的数据成员和成员函数的声明和实现均需加以注释，成员函数的必要步骤要加以注释。</p>
</blockquote>
<h2 id="二、类的设计"><a href="#二、类的设计" class="headerlink" title="二、类的设计"></a>二、类的设计</h2><h3 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h3><p>首先设计精灵的基类，所有精灵都有具备这些属性以及函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pet_base_class</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">string</span> name;<span class="comment">//宠物名字</span></span><br><span class="line">    pet_type type;<span class="comment">//宠物类别</span></span><br><span class="line">    <span class="keyword">int</span> id;<span class="comment">//宠物身份唯一标识</span></span><br><span class="line">    <span class="keyword">int</span> atk;<span class="comment">//攻击值</span></span><br><span class="line">    <span class="keyword">int</span> def;<span class="comment">//防御值</span></span><br><span class="line">    <span class="keyword">int</span> hp;<span class="comment">//总血量</span></span><br><span class="line">    <span class="keyword">int</span> speed;<span class="comment">//闪避速度</span></span><br><span class="line">    <span class="keyword">int</span> crit_rate;<span class="comment">//暴击率</span></span><br><span class="line">    <span class="keyword">int</span> remaining_hp;<span class="comment">//当前血量</span></span><br><span class="line">    pet_status status;<span class="comment">//宠物当前状态</span></span><br><span class="line">    <span class="keyword">int</span> remaining_chaos_time;<span class="comment">//状态异常剩余时间</span></span><br><span class="line">    <span class="comment">//string skill_name[4];//普通攻击和三种技能</span></span><br><span class="line">    <span class="comment">//string skill_description[4];</span></span><br><span class="line">    <span class="comment">//int skill_pp[3];//普通攻击pp为无限</span></span><br><span class="line">    <span class="keyword">int</span> level;<span class="comment">//宠物等级</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">exp</span>;<span class="comment">//总的经验值</span></span><br><span class="line">    <span class="keyword">int</span> attack_interval;<span class="comment">//攻击间隔,先只弄一个技能，后续再添加,20/9/1 考虑攻击间隔为出招速度，在对战开始时，出招速度</span></span><br><span class="line">    <span class="comment">//快的宠物优先出招，只需要在战斗开始时判断一下谁的出招速度快就可以了</span></span><br><span class="line">    <span class="keyword">int</span> total_pp;<span class="comment">//只有一个技能</span></span><br><span class="line">    <span class="built_in">string</span> skill_name;</span><br><span class="line">    <span class="keyword">int</span> remaining_pp;<span class="comment">//剩余技能使用次数，目前只有普通攻击，以后再考虑,2020/9/1考虑添加技能pp</span></span><br><span class="line">    <span class="keyword">int</span> exp_need[<span class="number">14</span>];<span class="comment">//每升一级需要的经验，英雄初始为一级，2-15；</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> atk_debuff;<span class="comment">//被干扰后的攻击力</span></span><br><span class="line">    <span class="keyword">int</span> def_debuff;<span class="comment">//被干扰后的防御力</span></span><br><span class="line">    <span class="keyword">int</span> speed_debuff;<span class="comment">//被干扰后的闪避速度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    pet_base_class(pet_type);</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">get_name</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> name; &#125;<span class="comment">//获得宠物名字</span></span><br><span class="line">    <span class="function">pet_type <span class="title">get_type</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> type; &#125;<span class="comment">//获得宠物类型</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_id</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> id; &#125;<span class="comment">//获得宠物id，唯一标识</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_atk</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> atk; &#125;<span class="comment">//获得宠物攻击值</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_def</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> def; &#125;<span class="comment">//获得宠物防御值</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_hp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> hp; &#125;<span class="comment">//获得宠物总血量</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_speed</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> speed; &#125;<span class="comment">//获得宠物攻速</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_crit_rate</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> crit_rate; &#125;<span class="comment">//获得宠物暴击率</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_remaining_hp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> remaining_hp; &#125;<span class="comment">//获得宠物当前血量</span></span><br><span class="line">    <span class="function">pet_status <span class="title">get_status</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> status; &#125;<span class="comment">//获得宠物当前状态</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_remaining_chaos_time</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> remaining_chaos_time;&#125;<span class="comment">//获得宠物异常状态剩余时间</span></span><br><span class="line">    <span class="comment">//string* get_skill_name() &#123; return skill_name; &#125;;//获得技能名字</span></span><br><span class="line">    <span class="comment">//string* get_skill_description() &#123; return skill_description; &#125;;//获得技能描述</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_pp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> total_pp; &#125;<span class="comment">//获得技能总pp</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_remaining_pp</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> remaining_pp;&#125;<span class="comment">//获得技能剩余pp</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_level</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> level; &#125;<span class="comment">//获得宠物等级</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_exp</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">exp</span>; &#125;<span class="comment">//获得宠物总经验值</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_attack_interval</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> attack_interval; &#125;<span class="comment">//获得宠物攻击间隔</span></span><br><span class="line">    <span class="comment">//int* get_remaining_pp() &#123; return remaining_pp; &#125;;//获得技能剩余次数</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_atk_debuff</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> atk_debuff;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_def_debuff</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> def_debuff;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_speed_debuff</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> speed_debuff;&#125;</span><br><span class="line">    <span class="function">bullet* <span class="title">normal_attack</span><span class="params">(<span class="keyword">int</span>&amp;)</span></span>;<span class="comment">//普通攻击,返回攻击对象的指针，将其传入对方的unde_attack函数中</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">under_attack</span><span class="params">(bullet*,<span class="keyword">int</span>&amp;)</span></span>;<span class="comment">//受到攻击,返回true说明战斗失败，接收攻击方的攻击信息</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> bullet* <span class="title">skill</span><span class="params">()</span> </span>= <span class="number">0</span>;<span class="comment">//使用技能,纯虚函数，使用方法与normal_attack类似</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;<span class="comment">//输出精灵信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_exp</span><span class="params">(<span class="keyword">int</span>)</span></span>;<span class="comment">//获取经验值,每次执行完该函数就要执行level_up_exp（）；</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">level_up_exp</span><span class="params">()</span></span>;<span class="comment">//通用升级函数，当exp经验值到了，会自动升一级，函数有潜在的问题，没有考虑一下子升多级的情况</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deal_chaos</span><span class="params">()</span></span>;<span class="comment">//处理异常状态函数,每次受到技能攻击后执行该函数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">chaos_recover</span><span class="params">()</span></span>;<span class="comment">//当宠物战败时，用于恢复到原来的状态</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">level_up_attribute</span><span class="params">()</span> </span>= <span class="number">0</span>;<span class="comment">//将自身属性升级，在level_up_exp（）中被调用</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">get_status_string</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (status)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> normal:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;normal&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> critical:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;critical&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> dizz:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;dizz&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> attack_debased:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;attack_debased&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> defence_debased:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;defence_debased&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> speed_debased:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;speed_debased&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>枚举类型，pet_type表示宠物类型，pet_status表示宠物的状态</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> pet_type</span><br><span class="line">&#123;</span><br><span class="line">    ATK, <span class="comment">//high attack</span></span><br><span class="line">    HP,	<span class="comment">//high HP</span></span><br><span class="line">    DEF, <span class="comment">//high defence</span></span><br><span class="line">    SPE	<span class="comment">//high speed</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum</span> pet_status</span><br><span class="line">&#123;</span><br><span class="line">    normal,<span class="comment">//正常</span></span><br><span class="line">    critical,<span class="comment">//暴击</span></span><br><span class="line">    dizz,<span class="comment">//眩晕，无法释放技能</span></span><br><span class="line">    attack_debased,<span class="comment">//攻击力被降低</span></span><br><span class="line">    defence_debased,<span class="comment">//防御值被降低</span></span><br><span class="line">    speed_debased<span class="comment">//闪避速度被降低</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>攻击类的设计，每当宠物使用技能时，就会将攻击的信息传入bullet中，由对方的宠物接收该bullet，进行血量以及状态的修改</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bullet</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bullet();</span><br><span class="line">    bullet(<span class="keyword">const</span> bullet&amp;);</span><br><span class="line">    <span class="keyword">void</span> <span class="keyword">operator</span>=(<span class="keyword">const</span> bullet&amp;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> damage;<span class="comment">//基础伤害</span></span><br><span class="line">    pet_status status;<span class="comment">//该技能会对对方造成的debuff</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>设计不同属性的精灵，完成升级函数的设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Speed</span> :</span> <span class="keyword">public</span> pet_base_class</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        Speed() :pet_base_class(SPE) &#123;&#125;;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">level_up_attribute</span><span class="params">()</span></span>;<span class="comment">//升级属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Attack</span> :</span><span class="keyword">public</span> pet_base_class</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        Attack() :pet_base_class(ATK) &#123;&#125;;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">level_up_attribute</span><span class="params">()</span></span>;<span class="comment">//升级属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Defence</span> :</span><span class="keyword">public</span> pet_base_class</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        Defence() :pet_base_class(DEF) &#123;&#125;;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">level_up_attribute</span><span class="params">()</span></span>;<span class="comment">//升级属性</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tank</span> :</span><span class="keyword">public</span> pet_base_class</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        Tank() :pet_base_class(HP) &#123;&#125;;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">level_up_attribute</span><span class="params">()</span></span>;<span class="comment">//升级属性</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>具体精灵的实现，设计每个精灵独有的攻击属性</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//皮卡丘</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pikachu</span> :</span> <span class="keyword">public</span> Speed</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Pikachu(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//火球鼠</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cyndaquil</span> :</span> <span class="keyword">public</span> Speed</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Cyndaquil(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//烈焰猴</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Infernape</span> :</span> <span class="keyword">public</span> Attack</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Infernape(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//喷火龙</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Charizard</span> :</span> <span class="keyword">public</span> Attack</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Charizard(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//妙蛙种子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bulbasaur</span> :</span> <span class="keyword">public</span> Defence</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Bulbasaur(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//卡比兽</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snorlax</span> :</span> <span class="keyword">public</span> Defence</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Snorlax(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//杰尼龟</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Squirtle</span> :</span> <span class="keyword">public</span> Tank</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Squirtle(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//独角虫</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weedle</span> :</span> <span class="keyword">public</span> Tank</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">bullet* <span class="title">skill</span><span class="params">()</span></span>;</span><br><span class="line">    Weedle(<span class="keyword">int</span>,<span class="keyword">int</span>);<span class="comment">//生成相应等级的宠物</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h3><p>用户的注册和登录，使用socket进行通信，分为客户端和服务器端</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>用户类的设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    user();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="built_in">string</span> user_name;</span><br><span class="line">    <span class="built_in">string</span> user_password;</span><br><span class="line">    <span class="keyword">int</span> win_session;<span class="comment">//胜场</span></span><br><span class="line">    <span class="keyword">int</span> total_session;<span class="comment">//总场</span></span><br><span class="line">    <span class="keyword">int</span> senior_pet_medal;<span class="comment">//高级精灵奖章:15级精灵个数</span></span><br><span class="line">    <span class="keyword">int</span> number_pet_medal;<span class="comment">//精灵个数奖章:精灵个数</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>登录窗口设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login_widget</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login_widget</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">login_widget</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~login_widget();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::login_widget *ui;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">login</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">regist</span><span class="params">(<span class="built_in">string</span>, <span class="built_in">string</span>)</span></span>;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_login_button</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_regist_button</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_exit_button</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_regist_in_regist</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_return_to_login</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">warning</span><span class="params">(QString warn)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>网络层 接收端设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span> :</span> <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	SOCKET sock;<span class="comment">//创建套接字</span></span><br><span class="line">    <span class="comment">//const int PORT = 8000;</span></span><br><span class="line">	<span class="comment">//char buf[1024];//用于接收信息</span></span><br><span class="line">    sockaddr_in servAddr;<span class="comment">//服务端地址</span></span><br><span class="line">    sockaddr fromAddr;</span><br><span class="line">    QString username;</span><br><span class="line">    <span class="comment">//struct sockaddr clntAddr;//客户端地址</span></span><br><span class="line">	<span class="comment">//Pikachu* pet;//定义了一只宠物</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	server();</span><br><span class="line">    ~server();</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">login_success</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">warning</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_user</span><span class="params">(user&amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_pet_backpack</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_info</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_status</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">receive_pet_information</span><span class="params">(<span class="built_in">string</span>&amp;)</span></span>;<span class="comment">//接收宠物信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_choose_defeat_pet</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_medal</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">login</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> password)</span></span>;<span class="comment">//发送登录请求</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">regist</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> password)</span></span>;<span class="comment">//发送注册信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_all_user_information</span><span class="params">()</span></span>;<span class="comment">//获得所有用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_all_user_status</span><span class="params">()</span></span>;<span class="comment">//获得所有用户在线状态</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_user_pet_information</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//获得某个用户的精灵信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">logout</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//退出登录</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update_user_pet_information</span><span class="params">(pet_base_class&amp; pet,<span class="built_in">string</span> username)</span></span>;<span class="comment">//更新某用户的精灵信息 </span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update_user_information</span><span class="params">(user&amp; u)</span></span>;<span class="comment">//更新用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete_user_pet</span><span class="params">(<span class="keyword">int</span> id)</span></span>;<span class="comment">//删除某个精灵信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_server_pet_information</span><span class="params">()</span></span>;<span class="comment">//获得服务器精灵信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_1_level_pet</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//获得一个初始精灵</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_myuser</span><span class="params">()</span></span>;<span class="comment">//get user information</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_user_pet_through_id</span><span class="params">(<span class="keyword">int</span> id)</span></span>;<span class="comment">//根据宠物id获取宠物的详细信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert_pet</span><span class="params">(pet_base_class&amp;,<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_random_3_pet</span><span class="params">(<span class="built_in">string</span>)</span></span>;<span class="comment">//决斗赛失败，用户随机失去一个精灵</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">query_number_pet_and_15_number_pet</span><span class="params">(<span class="built_in">string</span>)</span></span>;<span class="comment">//查询用户宠物个数，15级宠物个数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>展示用户信息的窗口</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user_info_widget</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user_info_widget</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">user_info_widget</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~user_info_widget();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_user_info_widget</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::user_info_widget *ui;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_user_info</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_others_pet_backpack</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_info</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_status</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_my_item</span><span class="params">(QTableWidgetItem*)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h4><p>数据库的设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">database</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	sqlite3* db;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	database();</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">insert_user</span><span class="params">(user&amp;)</span></span>;<span class="comment">//插入用户</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">query_user</span><span class="params">(<span class="built_in">string</span> user_name, user&amp;)</span></span>;<span class="comment">//根据用户名查询用户,查询的结果保存在user类中</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">update_user</span><span class="params">(user&amp;)</span></span>;<span class="comment">//更新用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">get_user_list</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt;&amp;)</span></span>;<span class="comment">//获得用户信息列表</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">get_pet_list</span><span class="params">(<span class="built_in">string</span> user_name, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt;&amp;)</span></span>;<span class="comment">//获取某用户的精灵信息,第一个参数为精灵名</span></span><br><span class="line">	<span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; user_online_status;<span class="comment">//每当注册一个用户，就把用户名放进来 &lt;用户名，状态&gt;</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update_num_of_pet</span><span class="params">()</span></span>;<span class="comment">//每当精灵数改变时，就执行该函数，更新精灵数量</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_pet_number</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>&amp; uname)</span></span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">insert_pet</span><span class="params">(pet&amp;)</span></span>;<span class="comment">//插入精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">update_pet</span><span class="params">(pet&amp;)</span></span>;<span class="comment">//更新精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">delete_pet</span><span class="params">(<span class="built_in">string</span>&amp;)</span></span>;<span class="comment">//删除精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">query_pet</span><span class="params">(<span class="keyword">int</span> id, pet&amp;)</span></span>;<span class="comment">//根据id查询精灵</span></span><br><span class="line">	<span class="keyword">int</span> num_of_pet;<span class="comment">//计数，当前数据库有多少条记录，就是宠物的id，唯一身份标识</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>网络层 发送端设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	SOCKET sock;<span class="comment">//创建套接字</span></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> PORT = <span class="number">8000</span>;</span><br><span class="line">	<span class="comment">//char buf[1024];//用于接收信息</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servAddr</span>;</span><span class="comment">//服务端地址</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clntAddr</span>;</span><span class="comment">//客户端地址</span></span><br><span class="line">	database* my_database;</span><br><span class="line">	<span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt; itos_pet;<span class="comment">//8个精灵精灵名字和序号对照表，用于随机选取数字</span></span><br><span class="line">	<span class="keyword">int</span> pet_id;<span class="comment">//服务器有16个精灵，id为1-16.每当分发新精灵时，id要加一。</span></span><br><span class="line">	<span class="comment">//注意：每当启动服务器时要计算出当前宠物个数，初始化pet_id和user_online_status,暂时未做，要放在构造函数中初始化</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	server();</span><br><span class="line">	~server() &#123; <span class="keyword">delete</span> my_database; &#125;;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">deal_login</span><span class="params">(<span class="built_in">string</span> username,<span class="built_in">string</span> password)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">deal_regist</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> password)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deal_logout</span><span class="params">(<span class="built_in">string</span> username)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_all_user_status</span><span class="params">()</span></span>;<span class="comment">//发送所有用户的在线状态信息、</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_all_user_information</span><span class="params">()</span></span>;<span class="comment">//发送所有用户的信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_user_pet_infomation</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//发送某用户拥有的精灵信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_server_pet_information</span><span class="params">()</span></span>;<span class="comment">//发送服务器精灵信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">new_1_level_pet</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> pet_name)</span></span>;<span class="comment">//给用户分发一个1级精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update_user_pet_information</span><span class="params">(pet&amp;)</span></span>;<span class="comment">//更新用户精灵的信息，这里输入暂定为一个精灵对象</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete_user_pet</span><span class="params">(<span class="built_in">string</span>&amp;)</span></span>;<span class="comment">//删除用户的一个精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update_user_information</span><span class="params">(user&amp;)</span></span>;<span class="comment">//更新用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_user_information</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//发送用户信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">send_user_pet_through_id</span><span class="params">(<span class="keyword">int</span> id)</span></span>;<span class="comment">//通过id发送精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_pet_when_win</span><span class="params">(pet&amp;)</span></span>;<span class="comment">//决斗赛胜利了，那么获得对手的精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_random_3_pet</span><span class="params">(<span class="built_in">string</span> username)</span></span>;<span class="comment">//随机获得三个精灵</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">get_pet_number</span><span class="params">(<span class="built_in">string</span> uname)</span></span>;<span class="comment">//查询宠物个数和15级宠物个数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>;<span class="comment">//从客户端收到的信息</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>用户类设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    user();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="built_in">string</span> user_name;</span><br><span class="line">    <span class="built_in">string</span> user_password;</span><br><span class="line">    <span class="keyword">int</span> win_session;<span class="comment">//胜场</span></span><br><span class="line">    <span class="keyword">int</span> total_session;<span class="comment">//总场</span></span><br><span class="line">    <span class="keyword">int</span> senior_pet_medal;<span class="comment">//高级精灵奖章:15级精灵个数</span></span><br><span class="line">    <span class="keyword">int</span> number_pet_medal;<span class="comment">//精灵个数奖章:精灵个数</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h3><p>选择精灵场景</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">choose_pet_widget</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">choose_pet_widget</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">choose_pet_widget</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~choose_pet_widget();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_choose_pet_widget</span><span class="params">()</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_choose_pet</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start_battle</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::choose_pet_widget *ui;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_choose_pet_backpack</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_pet_1</span><span class="params">(QTableWidgetItem*)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">get_pet_2</span><span class="params">(QTableWidgetItem*)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_start_button</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_promotion_competition</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_duels_competition</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>对战场景</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">battle_widget</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">battle_widget</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">battle_widget</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~battle_widget();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">battle</span><span class="params">(pet_base_class&amp; a,pet_base_class&amp; b)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::battle_widget *ui;</span><br><span class="line">    pet_base_class * user_pet;</span><br><span class="line">    pet_base_class * server_pet;</span><br><span class="line">    <span class="keyword">int</span> battle_style;<span class="comment">//1为升级赛，2为决斗赛</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_two_pet</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_after_battle</span><span class="params">(<span class="keyword">bool</span> is_win,<span class="built_in">string</span> server_pet_name,<span class="keyword">int</span> server_pet_level,<span class="keyword">int</span> battle_s,<span class="keyword">int</span> user_pet_id)</span></span>;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_battle_ground</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_normal_attack</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_skill</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click_quit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>主界面的设计</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span> :</span> <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MainWindow</span><span class="params">(QWidget *parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~MainWindow();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">closeEvent</span><span class="params">(QCloseEvent *)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MainWindow *ui;</span><br><span class="line">    login_widget *login_window;</span><br><span class="line">    pet_backpack *pet_backpack_window;</span><br><span class="line">    user_info_widget * user_info_window;</span><br><span class="line">    choose_pet_widget * choose_pet_window;</span><br><span class="line">    battle_widget * battle_window;</span><br><span class="line">    server * myserver;</span><br><span class="line">    user* myuser;</span><br><span class="line">    <span class="comment">//battle_controller * battle;</span></span><br><span class="line">    pet_base_class * mypet;</span><br><span class="line">    <span class="built_in">string</span> save_user_pet_information;</span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">(QString)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_user</span><span class="params">(user&amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_MainWindow</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_pet_backpack</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_pet_backpack</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_others_pet_backpack</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="comment">//void exit_others_pet_backpack();</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_user_info_window</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_user_info_window</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_choose_pet_window</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exit_choose_pet_window</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">start_battle</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init_two_pet</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_after_battle</span><span class="params">(<span class="keyword">bool</span> is_win,<span class="built_in">string</span> server_pet_name,<span class="keyword">int</span> server_pet_level,<span class="keyword">int</span> battle_s,<span class="keyword">int</span> user_pet_id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">receive_pet_information</span><span class="params">(<span class="built_in">string</span>&amp;)</span></span>;<span class="comment">//接收宠物信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show_choose_defeat_pet</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">refresh_user_medal</span><span class="params">(<span class="built_in">string</span>)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="三、具体实现"><a href="#三、具体实现" class="headerlink" title="三、具体实现"></a>三、具体实现</h2><h3 id="题目一-1"><a href="#题目一-1" class="headerlink" title="题目一"></a>题目一</h3><h4 id="1、精灵的构造"><a href="#1、精灵的构造" class="headerlink" title="1、精灵的构造"></a>1、精灵的构造</h4><p>每个精灵都会在自己的父类上进行构造。基类的构造函数初始化所有精灵的通用属性，属性类的构造函数初始化精灵的升级函数，具体的精灵类则实现该精灵特有的攻击函数，下面以Cyndaquil为例</p>
<p>基类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pet_base_class::pet_base_class(pet_type t)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;type = t;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk = <span class="number">50</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def = <span class="number">20</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;hp = <span class="number">500</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed = <span class="number">10</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;crit_rate = <span class="number">0</span>;<span class="comment">//初始暴击率为0%</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">this</span>-&gt;status = normal;</span><br><span class="line">	<span class="keyword">this</span>-&gt;level = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;<span class="built_in">exp</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;attack_interval = <span class="number">2000</span>;<span class="comment">//2000毫秒</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_chaos_time = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>属性类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Speed::level_up_attribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;hp += <span class="keyword">this</span>-&gt;level;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;<span class="comment">//speed应该是闪避速度，攻击间隔才是攻击速度</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;speed_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;crit_rate += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;attack_interval -= <span class="number">50</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk_debuff = <span class="keyword">this</span>-&gt;atk;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def_debuff = <span class="keyword">this</span>-&gt;def;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed_debuff = <span class="keyword">this</span>-&gt;speed;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_hp = <span class="keyword">this</span>-&gt;hp;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp = <span class="keyword">this</span>-&gt;total_pp;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>精灵类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//火球鼠</span></span><br><span class="line">Cyndaquil::Cyndaquil(<span class="keyword">int</span> level,<span class="keyword">int</span> _id)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;name = <span class="string">&quot;Cyndaquil&quot;</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;type = SPE;</span><br><span class="line">    <span class="keyword">this</span>-&gt;id = _id;</span><br><span class="line">    <span class="keyword">this</span>-&gt;total_pp = <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp = <span class="keyword">this</span>-&gt;total_pp;</span><br><span class="line">	<span class="keyword">this</span>-&gt;skill_name = <span class="string">&quot;Cyndaquil_skill&quot;</span>;</span><br><span class="line">	<span class="comment">//this-&gt;level = level;</span></span><br><span class="line">	<span class="keyword">if</span> (level &lt; <span class="number">2</span>) <span class="keyword">this</span>-&gt;<span class="built_in">exp</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">this</span>-&gt;<span class="built_in">exp</span> = <span class="keyword">this</span>-&gt;exp_need[level - <span class="number">2</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; level; i++) <span class="keyword">this</span>-&gt;level_up_exp();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">bullet* <span class="title">Cyndaquil::skill</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp--;</span><br><span class="line">	bullet* attack = <span class="keyword">new</span> bullet;</span><br><span class="line">	attack-&gt;damage = <span class="keyword">this</span>-&gt;atk_debuff * <span class="keyword">this</span>-&gt;level / <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">int</span> p = rand() % <span class="number">100</span>;</span><br><span class="line">	<span class="keyword">if</span> (p &lt; <span class="number">40</span>)<span class="comment">//有40%的几率降低对方防御</span></span><br><span class="line">	&#123;</span><br><span class="line">		attack-&gt;status = defence_debased;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		attack-&gt;status = normal;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt; <span class="string">&quot; use skill_attack, damage = &quot;</span> &lt;&lt; attack-&gt;damage &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> attack;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、精灵攻击方式"><a href="#2、精灵攻击方式" class="headerlink" title="2、精灵攻击方式"></a>2、精灵攻击方式</h4><h5 id="普通攻击"><a href="#普通攻击" class="headerlink" title="普通攻击"></a>普通攻击</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">bullet* <span class="title">pet_base_class::normal_attack</span><span class="params">(<span class="keyword">int</span> &amp; i)</span><span class="comment">//普通攻击暴击i为1，不暴击为0</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	bullet* attack = <span class="keyword">new</span> bullet;</span><br><span class="line">	attack-&gt;status = normal;</span><br><span class="line">    attack-&gt;damage = <span class="keyword">this</span>-&gt;atk_debuff * <span class="keyword">this</span>-&gt;level / <span class="number">3</span>;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;normal attack damage &quot; &lt;&lt; attack-&gt;damage;</span></span><br><span class="line">	<span class="keyword">int</span> p = rand() % <span class="number">100</span>;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (p &lt;= <span class="keyword">this</span>-&gt;crit_rate)<span class="comment">//普通攻击如果暴击</span></span><br><span class="line">	&#123;</span><br><span class="line">        i = <span class="number">1</span>;</span><br><span class="line">		attack-&gt;status = critical;</span><br><span class="line">        <span class="keyword">if</span>(attack-&gt;damage != <span class="number">0</span>)</span><br><span class="line">            attack-&gt;damage += <span class="number">10</span> * <span class="keyword">this</span>-&gt;level;<span class="comment">//伤害增加</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;critical!&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt;<span class="string">&quot; use normal_attack, damage = &quot;</span> &lt;&lt; attack-&gt;damage &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> attack;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>普通攻击造成一定的伤害，并且有一定几率暴击，暴击的效果和精灵的当前等级有关</p>
<h5 id="技能攻击"><a href="#技能攻击" class="headerlink" title="技能攻击"></a>技能攻击</h5><p>不同精灵的技能有不同的攻击属性，下面以Pikachu为例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">bullet* <span class="title">Pikachu::skill</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp--;</span><br><span class="line">	bullet* attack = <span class="keyword">new</span> bullet;</span><br><span class="line">	attack-&gt;damage = <span class="keyword">this</span>-&gt;atk_debuff * <span class="keyword">this</span>-&gt;level / <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">int</span> p = rand() % <span class="number">100</span>;</span><br><span class="line">	<span class="keyword">if</span> (p &lt; <span class="number">30</span>)<span class="comment">//有30%的几率降低对方攻击力</span></span><br><span class="line">	&#123;</span><br><span class="line">		attack-&gt;status = attack_debased;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		attack-&gt;status = normal;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt; <span class="string">&quot; use skill_attack, damage = &quot;</span> &lt;&lt; attack-&gt;damage &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> attack;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>技能攻击会造成一定伤害，并且有一定几率使对手陷入异常状态，异常状态包括攻击力下降，防御力下降，闪避速度下降，眩晕</p>
<h5 id="受到伤害"><a href="#受到伤害" class="headerlink" title="受到伤害"></a>受到伤害</h5><p>精灵使用技能后，计算出该技能的伤害和异常状态，返回值传入bullet类中，然后对手精灵接收该bullet类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">pet_base_class::under_attack</span><span class="params">(bullet* attack,<span class="keyword">int</span>&amp; i)</span><span class="comment">//被攻击精灵 的 状态</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> damage;</span><br><span class="line">	<span class="keyword">int</span> p = rand() % <span class="number">100</span>;</span><br><span class="line">	<span class="keyword">if</span> (p &lt; <span class="keyword">this</span>-&gt;speed_debuff)<span class="comment">//如果闪避</span></span><br><span class="line">	&#123;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">		damage = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;sidestep&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	damage = attack-&gt;damage - <span class="keyword">this</span>-&gt;def_debuff * <span class="keyword">this</span>-&gt;level / <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> (damage &lt; <span class="number">0</span>) damage = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">	<span class="keyword">switch</span> (attack-&gt;status)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> normal:</span><br><span class="line">        i = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under normal attack&quot;</span> &lt;&lt; <span class="built_in">endl</span>;<span class="comment">//受到了普通攻击效果，可能是普通攻击或者技能攻击</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> critical:</span><br><span class="line">        i =<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under critical normal attack&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> dizz:</span><br><span class="line">        i=<span class="number">3</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under dizz&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> attack_debased:</span><br><span class="line">        i=<span class="number">4</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under attack_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> defence_debased:</span><br><span class="line">        i=<span class="number">5</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under defence_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> speed_debased:</span><br><span class="line">        i=<span class="number">6</span>;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;under speed_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt; <span class="string">&quot; takes damage: &quot;</span> &lt;&lt; damage &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;remaining_chaos_time == <span class="number">0</span> || attack-&gt;status != normal)<span class="comment">//如果不处于异常状态</span></span><br><span class="line">		<span class="keyword">this</span>-&gt;status = attack-&gt;status;<span class="comment">//被攻击 获得debuff</span></span><br><span class="line">	<span class="keyword">if</span> (attack-&gt;status != normal &amp;&amp; attack-&gt;status != critical)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;remaining_chaos_time = <span class="number">2</span>;<span class="comment">//默认会debuff两个回合</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (damage &gt;= <span class="keyword">this</span>-&gt;remaining_hp)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>-&gt;remaining_hp = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//血量为0，返回true，战斗失败</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;remaining_hp -= damage;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="keyword">this</span>-&gt;get_name() &lt;&lt; <span class="string">&quot; hp is : &quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;remaining_hp &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="异常状态处理"><a href="#异常状态处理" class="headerlink" title="异常状态处理"></a>异常状态处理</h5><p>异常状态会持续两个回合</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pet_base_class::deal_chaos</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (remaining_chaos_time == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;atk_debuff = <span class="keyword">this</span>-&gt;atk;</span><br><span class="line">		<span class="keyword">this</span>-&gt;def_debuff = <span class="keyword">this</span>-&gt;def;</span><br><span class="line">		<span class="keyword">this</span>-&gt;speed_debuff = <span class="keyword">this</span>-&gt;speed;</span><br><span class="line">		<span class="keyword">this</span>-&gt;status = normal;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">this</span>-&gt;status)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> dizz:</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;status:dizz  &quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;atk_debuff = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> attack_debased:</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;status:attack_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;atk_debuff = <span class="keyword">this</span>-&gt;atk - <span class="number">2</span> * <span class="keyword">this</span>-&gt;level;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> defence_debased:</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;status:defence_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;def_debuff = <span class="keyword">this</span>-&gt;def - <span class="number">2</span> * <span class="keyword">this</span>-&gt;level;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> speed_debased:</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;status:speed_debased&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;speed_debuff = <span class="keyword">this</span>-&gt;speed - <span class="number">2</span> * <span class="keyword">this</span>-&gt;level;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>-&gt;remaining_chaos_time &gt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">this</span>-&gt;remaining_chaos_time--;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pet_base_class::chaos_recover</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;status = normal;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_chaos_time = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk_debuff = <span class="keyword">this</span>-&gt;atk;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def_debuff = <span class="keyword">this</span>-&gt;def;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed_debuff = <span class="keyword">this</span>-&gt;speed;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_hp = <span class="keyword">this</span>-&gt;hp;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp = <span class="keyword">this</span>-&gt;remaining_pp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="升级函数"><a href="#升级函数" class="headerlink" title="升级函数"></a>升级函数</h5><p>每种属性的精灵有着不同的升级函数，当经验累积到一定程度，就会自动升级</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Speed::level_up_attribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;hp += <span class="keyword">this</span>-&gt;level;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;<span class="comment">//speed应该是闪避速度，攻击间隔才是攻击速度</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;speed_debuff += <span class="keyword">this</span>-&gt;level / <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;crit_rate += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;attack_interval -= <span class="number">50</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;atk_debuff = <span class="keyword">this</span>-&gt;atk;</span><br><span class="line">	<span class="keyword">this</span>-&gt;def_debuff = <span class="keyword">this</span>-&gt;def;</span><br><span class="line">	<span class="keyword">this</span>-&gt;speed_debuff = <span class="keyword">this</span>-&gt;speed;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_hp = <span class="keyword">this</span>-&gt;hp;</span><br><span class="line">	<span class="keyword">this</span>-&gt;remaining_pp = <span class="keyword">this</span>-&gt;total_pp;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="题目二-1"><a href="#题目二-1" class="headerlink" title="题目二"></a>题目二</h3><h4 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h4><h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server::server()</span><br><span class="line">&#123;</span><br><span class="line">    WSADATA wsaData;</span><br><span class="line">    WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wsaData);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建套接字</span></span><br><span class="line">    sock = socket(PF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定套接字</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;servAddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(servAddr));  <span class="comment">//每个字节都用0填充</span></span><br><span class="line">    servAddr.sin_family = PF_INET;  <span class="comment">//使用IPv4地址</span></span><br><span class="line">    servAddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">    servAddr.sin_port = htons(<span class="number">1234</span>);  <span class="comment">//端口</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发送登录请求"><a href="#发送登录请求" class="headerlink" title="发送登录请求"></a>发送登录请求</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::login</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;username = QString::fromStdString(username);</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;1;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += password;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span> &lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="comment">//qDebug()&lt;&lt;WSAGetLastError();</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发送注册请求"><a href="#发送注册请求" class="headerlink" title="发送注册请求"></a>发送注册请求</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::regist</span><span class="params">(<span class="built_in">string</span> username, <span class="built_in">string</span> password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;2;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += password;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span> &lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获得所有用户信息"><a href="#获得所有用户信息" class="headerlink" title="获得所有用户信息"></a>获得所有用户信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_all_user_information</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;3&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获取所有用户在线状态"><a href="#获取所有用户在线状态" class="headerlink" title="获取所有用户在线状态"></a>获取所有用户在线状态</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_all_user_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;4&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获得某个用户的精灵信息"><a href="#获得某个用户的精灵信息" class="headerlink" title="获得某个用户的精灵信息"></a>获得某个用户的精灵信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_user_pet_information</span><span class="params">(<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;5;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发送注销请求"><a href="#发送注销请求" class="headerlink" title="发送注销请求"></a>发送注销请求</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::logout</span><span class="params">(<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;6;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="更新用户的精灵信息"><a href="#更新用户的精灵信息" class="headerlink" title="更新用户的精灵信息"></a>更新用户的精灵信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::update_user_pet_information</span><span class="params">(pet_base_class&amp; pet,<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;7;&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_id());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += pet.get_name();</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_atk());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_def());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_hp());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_crit_rate());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_speed());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_level());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_exp());</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="更新用户的信息"><a href="#更新用户的信息" class="headerlink" title="更新用户的信息"></a>更新用户的信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::update_user_information</span><span class="params">(user&amp; u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;8;&quot;</span>;</span><br><span class="line">    msg += u.user_name;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += u.user_password;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(u.win_session);</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(u.total_session);</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(u.senior_pet_medal);</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(u.number_pet_medal);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="删除用户宠物"><a href="#删除用户宠物" class="headerlink" title="删除用户宠物"></a>删除用户宠物</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::delete_user_pet</span><span class="params">(<span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;9;&quot;</span>;</span><br><span class="line">    msg += to_string(id);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获得服务器端宠物信息"><a href="#获得服务器端宠物信息" class="headerlink" title="获得服务器端宠物信息"></a>获得服务器端宠物信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_server_pet_information</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;:&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="随机获得一个一级的宠物"><a href="#随机获得一个一级的宠物" class="headerlink" title="随机获得一个一级的宠物"></a>随机获得一个一级的宠物</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_1_level_pet</span><span class="params">(<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;;;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="插入一个宠物"><a href="#插入一个宠物" class="headerlink" title="插入一个宠物"></a>插入一个宠物</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::insert_pet</span><span class="params">(pet_base_class&amp; pet,<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;&gt;;&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_id());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += pet.get_name();</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_atk());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_def());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_hp());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_crit_rate());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_speed());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_level());</span><br><span class="line">    msg += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">    msg += to_string(pet.get_exp());</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="随机获得三个宠物"><a href="#随机获得三个宠物" class="headerlink" title="随机获得三个宠物"></a>随机获得三个宠物</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::get_random_3_pet</span><span class="params">(<span class="built_in">string</span> username)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> msg;</span><br><span class="line">    msg += <span class="string">&quot;?;&quot;</span>;</span><br><span class="line">    msg += username;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ch = msg.c_str();</span><br><span class="line">    qDebug() &lt;&lt; <span class="string">&quot;clinet:&quot;</span>&lt;&lt; ch;</span><br><span class="line">    sendto(sock, ch, <span class="built_in">strlen</span>(ch), <span class="number">0</span>, (struct sockaddr*)&amp;servAddr, <span class="keyword">sizeof</span>(servAddr));</span><br><span class="line">    <span class="keyword">this</span>-&gt;receive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="接收来自服务器的信息"><a href="#接收来自服务器的信息" class="headerlink" title="接收来自服务器的信息"></a>接收来自服务器的信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::receive</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> addrLen = <span class="keyword">sizeof</span>(fromAddr);</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">    recvfrom(sock, buf, <span class="number">1023</span>, <span class="number">0</span>, &amp;fromAddr, &amp;addrLen);<span class="comment">//接收请求报文</span></span><br><span class="line">    <span class="comment">//if (buff_size &lt;= 0) continue;</span></span><br><span class="line">    qDebug() &lt;&lt;  <span class="string">&quot;server:&quot;</span> &lt;&lt; buf;</span><br><span class="line">    <span class="keyword">switch</span>(buf[<span class="number">0</span>]-<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment">//login successful</span></span><br><span class="line">        <span class="function">emit <span class="title">login_success</span><span class="params">(<span class="keyword">this</span>-&gt;username)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="function">emit <span class="title">warning</span><span class="params">(<span class="string">&quot;Wrong password!&quot;</span>)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="function">emit <span class="title">warning</span><span class="params">(<span class="string">&quot;User does not exist!&quot;</span>)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="function">emit <span class="title">warning</span><span class="params">(<span class="string">&quot;User already exists!&quot;</span>)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="comment">//regist successful</span></span><br><span class="line">        <span class="function">emit <span class="title">warning</span><span class="params">(<span class="string">&quot;Regist successful! Login again please&quot;</span>)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg;</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        user* u = <span class="keyword">new</span> user;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;user_name = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">        <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;user_password = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;win_session = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">        <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;total_session = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">        <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;senior_pet_medal = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">        <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">        u-&gt;number_pet_medal = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">        <span class="function">emit <span class="title">init_user</span><span class="params">(*u)</span></span>;</span><br><span class="line">        <span class="keyword">delete</span> u;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">refresh_pet_backpack</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">refresh_user_info</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">refresh_user_status</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">receive_pet_information</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">show_choose_defeat_pet</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> msg = buf;</span><br><span class="line">        <span class="function">emit <span class="title">refresh_user_medal</span><span class="params">(msg)</span></span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="服务器端-1"><a href="#服务器端-1" class="headerlink" title="服务器端"></a>服务器端</h4><h5 id="接收来自客户端的信息"><a href="#接收来自客户端的信息" class="headerlink" title="接收来自客户端的信息"></a>接收来自客户端的信息</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">server::receive</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">        <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">        <span class="keyword">int</span> nSize = <span class="keyword">sizeof</span>(SOCKADDR);</span><br><span class="line">        <span class="keyword">int</span> buff_size = recvfrom(sock, buf, <span class="number">1023</span>, <span class="number">0</span>, (struct sockaddr*)&amp;clntAddr, &amp;nSize);<span class="comment">//接收请求报文 </span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (buff_size &lt;= <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, buf);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;form ip adrress&quot;</span> &lt;&lt; ntohl(clntAddr.sin_addr.s_addr) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">switch</span> (buf[<span class="number">0</span>] - <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//登陆请求,buf里包含着用户名和密码，中间用，分隔     1;username,password</span></span><br><span class="line">            <span class="built_in">string</span> uname, pword;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pword += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (deal_login(uname, pword))</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//注册请求，buf里包含着用户名和密码，中间用，分隔     2;username,password</span></span><br><span class="line">            <span class="built_in">string</span> uname, pword;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pword += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            deal_regist(uname, pword);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//获取所有的用户信息   3</span></span><br><span class="line">            send_all_user_information();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//获得用户在线状态   4</span></span><br><span class="line">            send_all_user_status();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//获得某用户的精灵信息  5;uname</span></span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            send_user_pet_infomation(uname);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//退出登录 6;uname</span></span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            deal_logout(uname);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//更新某用户的精灵信息     7;id,username,name,atk,def,hp,crit_rate,speed,level,exp</span></span><br><span class="line">            <span class="built_in">string</span> msg;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            pet *p = <span class="keyword">new</span> pet;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;id = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;username = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;name = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;atk = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;def = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;hp = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;crit_rate = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;speed = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;level = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;<span class="built_in">exp</span> = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            update_user_pet_information(*p);</span><br><span class="line">            p-&gt;print();</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//更新用户信息     8;name,password,win,total,senior_pet_model,number_pet_medel </span></span><br><span class="line">            <span class="built_in">string</span> msg;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            user* u = <span class="keyword">new</span> user;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;user_name = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;user_password = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;win_session = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;total_session = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;senior_pet_medal = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            u-&gt;number_pet_medal = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            update_user_information(*u);</span><br><span class="line">            <span class="comment">//u-&gt;print();</span></span><br><span class="line">            <span class="keyword">delete</span> u;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//删除某用户的精灵信息     9;id</span></span><br><span class="line">            <span class="built_in">string</span> id;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                id += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; id &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            delete_user_pet(id);</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>:   <span class="comment">//:冒号</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//发送服务器精灵信息    10</span></span><br><span class="line">            send_server_pet_information();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>: <span class="comment">//;分号</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//给用户一个初始精灵    ;;username</span></span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> p = rand() % <span class="number">8</span>;</span><br><span class="line">            new_1_level_pet(uname, itos_pet[p]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">12</span>:<span class="comment">//&lt; 小于号 &lt;;uname</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            send_user_information(uname);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13</span>:<span class="comment">//=等号  &lt;;id</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> id;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                id += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            send_user_pet_through_id(stoi(id));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">14</span>: <span class="comment">// &gt;大于号   插入获得的精灵  &gt;;id,username,name,atk,def,hp,crit_rate,speed,level,exp</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> msg;</span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            pet* p = <span class="keyword">new</span> pet;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;id = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;username = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;name = msg; msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;atk = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;def = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;hp = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;crit_rate = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;speed = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;,&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;level = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            <span class="keyword">for</span> (; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++) msg += buf[i];</span><br><span class="line">            p-&gt;<span class="built_in">exp</span> = stoi(msg); msg = <span class="string">&quot;&quot;</span>; i++;</span><br><span class="line">            get_pet_when_win(*p);</span><br><span class="line">            p-&gt;print();</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">15</span>:<span class="comment">//随机三个精灵，  ?;username</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            get_random_3_pet(uname);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:<span class="comment">//查询用户宠物个数和15级宠物个数</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> uname;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; buf[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                uname += buf[i];</span><br><span class="line">            &#125;</span><br><span class="line">            get_pet_number(uname);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/py3-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/py3-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/" class="post-title-link" itemprop="url">Python程序设计作业#3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 11:11:41 / Modified: 11:18:08" itemprop="dateCreated datePublished" datetime="2020-11-10T11:11:41+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python程序设计-3作业"><a href="#Python程序设计-3作业" class="headerlink" title="Python程序设计#3作业"></a>Python程序设计#3作业</h1><p>截止时间：2020年11月09日23:59:59</p>
<h2 id="作业题目"><a href="#作业题目" class="headerlink" title="作业题目"></a>作业题目</h2><p>实现localProxy和remoteProxy分离式代理。</p>
<p>支持SOCKS5代理和HTTPS代理（基于#2作业的成果）。</p>
<p>localProxy收到的每个TCP连接单独建立代理TCP连接。</p>
<h2 id="作业内容"><a href="#作业内容" class="headerlink" title="作业内容"></a>作业内容</h2><p>程序源代码嵌入下方的code block中。</p>
<p>local proxy</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"><span class="keyword">import</span> nest_asyncio</span><br><span class="line">nest_asyncio.apply()</span><br><span class="line">VERSION = <span class="number">5</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">socks5</span>(<span class="params">first, reader, writer</span>):</span></span><br><span class="line">    addr_from = writer.get_extra_info(<span class="string">&#x27;peername&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">f&#x27;connect from<span class="subst">&#123;addr_from&#125;</span>&#x27;</span>)</span><br><span class="line">    header = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">    header = first + header</span><br><span class="line">    ver, num_method = struct.unpack(<span class="string">&quot;!BB&quot;</span>, header)</span><br><span class="line">    logging.info(<span class="string">f&#x27;ver == VERSION:<span class="subst">&#123;ver == VERSION&#125;</span>&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;num_method = %d&#x27;</span> % num_method)</span><br><span class="line">    methods = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_method):</span><br><span class="line">        methods.append(ord(<span class="keyword">await</span> reader.read(<span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">in</span> methods:<span class="comment">#无需认证</span></span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#回应一个数据包，包括协议版本号，指定认证方法</span></span><br><span class="line">    writer.write(struct.pack(<span class="string">&quot;!BB&quot;</span>, VERSION, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    request = <span class="keyword">await</span> reader.read(<span class="number">4</span>)</span><br><span class="line">    ver, cmd, rsv, atype = struct.unpack(<span class="string">&quot;!BBBB&quot;</span>, request)</span><br><span class="line">    <span class="keyword">assert</span> ver == VERSION</span><br><span class="line">    <span class="comment">#ipv4</span></span><br><span class="line">    <span class="keyword">if</span> atype == <span class="number">1</span>:</span><br><span class="line">        address = socket.inet_ntoa(<span class="keyword">await</span> reader.read(<span class="number">4</span>))</span><br><span class="line">    <span class="comment">#域名</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">3</span>:</span><br><span class="line">        domain_length = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">        address = <span class="keyword">await</span> reader.read(domain_length[<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#ipv6</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">4</span>:</span><br><span class="line">        address = socket.inet_ntop(socket.AF_INET6, <span class="keyword">await</span> reader.read(<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    port = struct.unpack(<span class="string">&#x27;!H&#x27;</span>, <span class="keyword">await</span> reader.read(<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="number">1</span>:</span><br><span class="line">            reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">10010</span>)</span><br><span class="line">            http_connect = <span class="string">&#x27;CONNECT &#x27;</span> + address.decode() + <span class="string">&#x27;:&#x27;</span> + str(port[<span class="number">0</span>]) + <span class="string">&#x27; HTTP/1.1&#x27;</span></span><br><span class="line">            print(<span class="string">&#x27;http_connect&#x27;</span>)</span><br><span class="line">            print(http_connect)</span><br><span class="line">            writer_remote.write(http_connect.encode())</span><br><span class="line">            <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line">            reply = <span class="keyword">await</span> (reader_remote.read(<span class="number">1024</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            writer.close()</span><br><span class="line">            writer.wait_closed()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">        logging.error(error)</span><br><span class="line">    reply = struct.pack(<span class="string">&quot;!BBBBIH&quot;</span>, VERSION, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    writer.write(reply)</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#第一个字节为0表示成功代理</span></span><br><span class="line">    <span class="keyword">if</span> cmd == <span class="number">1</span> <span class="keyword">and</span> reply[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        tasks = [read_trans(reader, writer_remote), write_trans(reader_remote, writer)]</span><br><span class="line">        <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">read_trans</span>(<span class="params">reader, writer_remote</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer_remote.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">write_trans</span>(<span class="params">reader_remote, writer</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader_remote.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">httptunnel</span>(<span class="params">first, reader, writer</span>):</span></span><br><span class="line">    http_connect = (<span class="keyword">await</span> reader.read(<span class="number">1024</span>))</span><br><span class="line">    http_connect = (first + http_connect).decode()</span><br><span class="line"></span><br><span class="line">    logging.info(http_connect)</span><br><span class="line"></span><br><span class="line">    reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">10010</span>)</span><br><span class="line">    writer_remote.write(http_connect.encode())</span><br><span class="line">    <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    reply = <span class="keyword">await</span> (reader_remote.read(<span class="number">1024</span>))</span><br><span class="line">    writer.write(reply)</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    <span class="comment">#连接建立成功</span></span><br><span class="line">    tasks = [read_trans(reader, writer_remote), write_trans(reader_remote, writer)]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">reader, writer</span>):</span></span><br><span class="line">    first = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span>(first == <span class="string">b&#x27;\x05&#x27;</span>):</span><br><span class="line">        <span class="keyword">await</span> socks5(first, reader, writer)</span><br><span class="line">    <span class="keyword">elif</span>(first == <span class="string">b&#x27;C&#x27;</span>):</span><br><span class="line">        <span class="keyword">await</span> httptunnel(first, reader, writer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    server = <span class="keyword">await</span> asyncio.start_server(test, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">10086</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> server:</span><br><span class="line">        <span class="keyword">await</span> server.serve_forever()</span><br><span class="line">        </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<p>remote proxy</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"><span class="keyword">import</span> nest_asyncio</span><br><span class="line">nest_asyncio.apply()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">reader_local, writer_local</span>):</span></span><br><span class="line">    http_connect = (<span class="keyword">await</span> reader_local.read(<span class="number">1024</span>))</span><br><span class="line">    http_connect = http_connect.decode()</span><br><span class="line">    logging.info(http_connect)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(http_connect[i] != <span class="string">&#x27;:&#x27;</span>): </span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    domain_name = http_connect[<span class="number">8</span> : i]</span><br><span class="line">    j = i</span><br><span class="line">    <span class="keyword">while</span>(http_connect[j] != <span class="string">&#x27; &#x27;</span>):</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">    port = http_connect[i + <span class="number">1</span> : j]</span><br><span class="line"></span><br><span class="line">    reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(domain_name,port)</span><br><span class="line"></span><br><span class="line">    reply = <span class="string">&#x27;HTTP/1.1 200 OK\r\n\r\n&#x27;</span></span><br><span class="line">    writer_local.write(reply.encode())</span><br><span class="line">    <span class="keyword">await</span> writer_local.drain()</span><br><span class="line"></span><br><span class="line">    tasks = [read_trans(reader_local, writer_remote), write_trans(reader_remote, writer_local)]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">read_trans</span>(<span class="params">reader, writer_remote</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer_remote.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">write_trans</span>(<span class="params">reader_remote, writer</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader_remote.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer.drain()</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    server = <span class="keyword">await</span> asyncio.start_server(handle, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">10010</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> server:</span><br><span class="line">        <span class="keyword">await</span> server.serve_forever()</span><br><span class="line">        </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>





<h2 id="代码说明（可选）"><a href="#代码说明（可选）" class="headerlink" title="代码说明（可选）"></a>代码说明（可选）</h2><p>源代码中不要出现大段的说明注释，如果需要可以可以在本节中加上说明。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/%E7%AE%97%E6%B3%95%E7%AD%94%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/%E7%AE%97%E6%B3%95%E7%AD%94%E6%A1%88/" class="post-title-link" itemprop="url">2020-2021算法设计与分析期中考试参考答案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 11:11:17 / Modified: 11:23:24" itemprop="dateCreated datePublished" datetime="2020-11-10T11:11:17+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2020-2021算法设计与分析期中考试参考答案"><a href="#2020-2021算法设计与分析期中考试参考答案" class="headerlink" title="2020-2021算法设计与分析期中考试参考答案"></a>2020-2021算法设计与分析期中考试参考答案</h1><h3 id="一、写出O，Θ，Ω的含义"><a href="#一、写出O，Θ，Ω的含义" class="headerlink" title="一、写出O，Θ，Ω的含义"></a>一、写出O，Θ，Ω的含义</h3><p>O(g(n)) = {f(n):  存在正常量c和n0，使得对所有n≥ n0，有0≤f(n)≤cg(n)}</p>
<p>Θ(g(n)) = {f(n):  存在正常量c1、c2和n0，使得对所有n≥ n0，有c1g(n)≤f(n)≤c2g(n)}</p>
<p>Ω(g(n)) = {f(n):  存在正常量c和n0，使得对所有n≥ n0，有f(n)≥cg(n)≥0}</p>
<h3 id="二、写出快速排序的Partition方法"><a href="#二、写出快速排序的Partition方法" class="headerlink" title="二、写出快速排序的Partition方法"></a>二、写出快速排序的Partition方法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Partition</span><span class="params">(<span class="keyword">int</span> q[], <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = q[(l + r) &gt;&gt; <span class="number">1</span>], i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(q[++i] &lt; x);</span><br><span class="line">        <span class="keyword">while</span>(q[--j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span>(i &lt; j)</span><br><span class="line">            <span class="built_in">std</span>::swap(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>附：快速排序</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">int</span> q[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quick_sort</span><span class="params">(<span class="keyword">int</span> q[], <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//一、确定边界点，一般是左边界q[l]，中间值q[l + r &gt;&gt; 1]，右边界q[r]，或者随机取</span></span><br><span class="line">    <span class="keyword">int</span> x = q[l + r &gt;&gt; <span class="number">1</span>], i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//二、调整区间，根据边界点的值x将整个区间分为两部分，使得左半边所有数均小于等于x，右半边所有数均大于等于x</span></span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(q[++i] &lt; x);<span class="comment">//从左边开始，找出第一个大于等于x的数</span></span><br><span class="line">        <span class="keyword">while</span>(q[--j] &gt; x);<span class="comment">//从右边开始，找出第一个小于等于x的数</span></span><br><span class="line">        <span class="keyword">if</span>(i &lt; j)</span><br><span class="line">            <span class="built_in">std</span>::swap(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//三、递归处理左右两个区间</span></span><br><span class="line">    quick_sort(q, l, j);</span><br><span class="line">    quick_sort(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    quick_sort(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、按照渐进阶从低到高的顺序排列以下表达式："><a href="#三、按照渐进阶从低到高的顺序排列以下表达式：" class="headerlink" title="三、按照渐进阶从低到高的顺序排列以下表达式："></a>三、按照渐进阶从低到高的顺序排列以下表达式：</h3><p>$$<br>4n^2, logn, 3^n, 20n, 2, n^{2/3}, n!<br>$$</p>
<p>答案：<br>$$<br>2, logn, n^{2/3}, 20n, 4n^2, 3^n, n!<br>$$</p>
<h3 id="四、逆序对"><a href="#四、逆序对" class="headerlink" title="四、逆序对"></a>四、逆序对</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="comment">//逆序对</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">int</span> q[N], temp[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">reverse_pair</span><span class="params">(<span class="keyword">int</span> q[], <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> res = reverse_pair(q, l, mid) + reverse_pair(q, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> i = l, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (q[i] &lt;= q[j]) temp[k++] = q[i++];</span><br><span class="line">        <span class="keyword">else</span> temp[k++] = q[j++], res += mid - i + <span class="number">1</span>;<span class="comment">//仅此处与归并排序不同</span></span><br><span class="line">        <span class="comment">/*左边和右边均已排好序，如果q[i] &gt; q[j]，那么i~mid之间的数字都会大于q[j],所以</span></span><br><span class="line"><span class="comment">        *对于左边第i个数，右边有mid - i + 1个数小于q[i]，逆序对数量要加上mid - i + 1</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) temp[k++] = q[i++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) temp[k++] = q[j++];</span><br><span class="line">    <span class="keyword">for</span>(i = l, k = <span class="number">0</span>; i &lt;= r; i++, k++) q[i] = temp[k];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    <span class="keyword">int</span> res = reverse_pair(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复杂度分析 T(n) = 2T(n / 2) + O(n)</p>
<p>由主定理得：T(n) = O(nlogn)</p>
<p>附：归并排序</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">int</span> q[N], temp[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge_sort</span><span class="params">(<span class="keyword">int</span> q[], <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    merge_sort(q, l, mid);<span class="comment">//左边排序</span></span><br><span class="line">    merge_sort(q, mid + <span class="number">1</span>, r);<span class="comment">//右边排序</span></span><br><span class="line">    <span class="keyword">int</span> i = l, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)<span class="comment">//合并，依次比较左右两边的数，较小的填入temp数组中</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(q[i] &lt;= q[j]) temp[k++] = q[i++];<span class="comment">//为了保证归并排序的稳定性，如果左右两边有相同的数，那么把左边的数先放入temp数组中</span></span><br><span class="line">        <span class="keyword">else</span> temp[k++] = q[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) temp[k++] = q[i++];<span class="comment">//将左边剩余的数填入temp数组中</span></span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) temp[k++] = q[j++];<span class="comment">//将右边剩余的数字填入temp数组中</span></span><br><span class="line">    <span class="keyword">for</span>(i = l, k = <span class="number">0</span>; i &lt;= r; i++, k++) q[i] = temp[k];<span class="comment">//将temp的数组移到原来的数组中</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    merge_sort(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="五、摆花"><a href="#五、摆花" class="headerlink" title="五、摆花"></a>五、摆花</h3><p>设f[i][j]表示前i个<strong>花瓶</strong>里放了j朵花的最大价值，对于第i个花瓶，只有放与不放两种选择</p>
<p>状态转移方程：<br>$$<br>f[i][j] = max(f[i - 1][j], f[i - 1][j - 1] + w[j][i])<br>$$<br>时间复杂度O(mn)，假设价值均大于0</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">10010</span>;</span><br><span class="line"><span class="keyword">int</span> w[N][N], f[N][N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m, n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;m, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;w[i][j]);</span><br><span class="line">    <span class="comment">//f[i][j]表示前i个花瓶里放前j束花的价值</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= <span class="built_in">std</span>::min(m, i); j++)</span><br><span class="line">            f[i][j] = <span class="built_in">std</span>::max(f[i - <span class="number">1</span>][j], f[i - <span class="number">1</span>][j - <span class="number">1</span>] + w[j][i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, f[n][m]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/picture-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/picture-test/" class="post-title-link" itemprop="url">picture-test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 10:07:37 / Modified: 10:10:51" itemprop="dateCreated datePublished" datetime="2020-11-10T10:07:37+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/2020/11/10/picture-test/1.png" alt="测试图片"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/py1-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/py1-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/" class="post-title-link" itemprop="url">Python程序设计作业#1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 10:07:37 / Modified: 11:17:27" itemprop="dateCreated datePublished" datetime="2020-11-10T10:07:37+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python程序设计作业-1"><a href="#Python程序设计作业-1" class="headerlink" title="Python程序设计作业#1"></a>Python程序设计作业#1</h1><p>提交邮箱：<a href="mailto:&#x62;&#117;&#x70;&#116;&#x6e;&#101;&#x40;&#103;&#x6d;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#109;">&#x62;&#117;&#x70;&#116;&#x6e;&#101;&#x40;&#103;&#x6d;&#x61;&#x69;&#108;&#46;&#99;&#x6f;&#109;</a></p>
<p>邮件标题：py1-班级-学号-姓名</p>
<p>邮件附件：py1-班级-学号-姓名.md（即本文件）</p>
<p>截止时间：2020年10月26日23:59:59</p>
<h2 id="作业题目"><a href="#作业题目" class="headerlink" title="作业题目"></a>作业题目</h2><p>使用asyncio的streams（coroutine based API）实现SOCKS5服务器。</p>
<p>协议参考：RFC 1928 - SOCKS Protocol Verison 5</p>
<p>只需要实现CMD X‘01’（即CONNECT）</p>
<p>只需要实现METHOD X‘00’（即NO AUTHENTICATION REQUIRED）</p>
<h2 id="作业内容"><a href="#作业内容" class="headerlink" title="作业内容"></a>作业内容</h2><p>程序源代码嵌入下方的code block中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"><span class="keyword">import</span> nest_asyncio</span><br><span class="line">nest_asyncio.apply()</span><br><span class="line">VERSION = <span class="number">5</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">reader, writer</span>):</span></span><br><span class="line">    addr_from = writer.get_extra_info(<span class="string">&#x27;peername&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">f&#x27;connect from<span class="subst">&#123;addr_from&#125;</span>&#x27;</span>)</span><br><span class="line">    header = <span class="keyword">await</span> reader.read(<span class="number">2</span>)</span><br><span class="line">    ver, num_method = struct.unpack(<span class="string">&quot;!BB&quot;</span>, header)</span><br><span class="line">    logging.info(<span class="string">f&#x27;ver == VERSION:<span class="subst">&#123;ver == VERSION&#125;</span>&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;num_method = %d&#x27;</span> % num_method)</span><br><span class="line">    methods = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_method):</span><br><span class="line">        methods.append(ord(<span class="keyword">await</span> reader.read(<span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">in</span> methods:<span class="comment">#无需认证</span></span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#回应一个数据包，包括协议版本号，指定认证方法</span></span><br><span class="line">    writer.write(struct.pack(<span class="string">&quot;!BB&quot;</span>, VERSION, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    request = <span class="keyword">await</span> reader.read(<span class="number">4</span>)</span><br><span class="line">    ver, cmd, rsv, atype = struct.unpack(<span class="string">&quot;!BBBB&quot;</span>, request)</span><br><span class="line">    <span class="keyword">assert</span> ver == VERSION</span><br><span class="line">    <span class="comment">#ipv4</span></span><br><span class="line">    <span class="keyword">if</span> atype == <span class="number">1</span>:</span><br><span class="line">        address = socket.inet_ntoa(<span class="keyword">await</span> reader.read(<span class="number">4</span>))</span><br><span class="line">    <span class="comment">#域名</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">3</span>:</span><br><span class="line">        domain_length = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">        address = <span class="keyword">await</span> reader.read(domain_length[<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#ipv6</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">4</span>:</span><br><span class="line">        address = socket.inet_ntop(socket.AF_INET6, <span class="keyword">await</span> reader.read(<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    port = struct.unpack(<span class="string">&#x27;!H&#x27;</span>, <span class="keyword">await</span> reader.read(<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="number">1</span>:</span><br><span class="line">            reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(address,port[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            writer.close()</span><br><span class="line">            writer.wait_closed()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">        logging.error(error)</span><br><span class="line">    reply = struct.pack(<span class="string">&quot;!BBBBIH&quot;</span>, VERSION, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    writer.write(reply)</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#第一个字节为0表示成功代理</span></span><br><span class="line">    <span class="keyword">if</span> cmd == <span class="number">1</span> <span class="keyword">and</span> reply[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        tasks = [read_trans(reader, writer_remote), write_trans(reader_remote, writer)]</span><br><span class="line">        <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">read_trans</span>(<span class="params">reader, writer_remote</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer_remote.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">write_trans</span>(<span class="params">reader_remote, writer</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader_remote.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    server = <span class="keyword">await</span> asyncio.start_server(handle, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10086</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> server:</span><br><span class="line">        <span class="keyword">await</span> server.serve_forever()</span><br><span class="line">        </span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h2 id="代码说明（可选）"><a href="#代码说明（可选）" class="headerlink" title="代码说明（可选）"></a>代码说明（可选）</h2><p>源代码中不要出现大段的说明注释，如果需要可以可以在本节中加上说明。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/10/py2-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/10/py2-2018211308-2018211430-%E5%91%A8%E7%91%9E%E5%8F%91/" class="post-title-link" itemprop="url">Python程序设计作业#2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-10 10:07:37 / Modified: 11:17:44" itemprop="dateCreated datePublished" datetime="2020-11-10T10:07:37+08:00">2020-11-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python程序设计-2作业"><a href="#Python程序设计-2作业" class="headerlink" title="Python程序设计#2作业"></a>Python程序设计#2作业</h1><p>截止时间：2020年11月02日23:59:59</p>
<h2 id="作业题目"><a href="#作业题目" class="headerlink" title="作业题目"></a>作业题目</h2><p>实现localProxy双协议（SOCKS5和HTTP tunnel）本地代理。</p>
<p>支持（SOCKS5代理）基于#1作业的成果。</p>
<p>支持HTTP tunnel（ 即HTTP CONNECT method）可用于HTTPS代理。</p>
<p>关于HTTP tunnel可以参见：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21955083">https://www.zhihu.com/question/21955083</a></p>
<h2 id="作业内容"><a href="#作业内容" class="headerlink" title="作业内容"></a>作业内容</h2><p>程序源代码嵌入下方的code block中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"><span class="keyword">import</span> nest_asyncio</span><br><span class="line">nest_asyncio.apply()</span><br><span class="line">VERSION = <span class="number">5</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">socks5</span>(<span class="params">first, reader, writer</span>):</span></span><br><span class="line">    addr_from = writer.get_extra_info(<span class="string">&#x27;peername&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">f&#x27;connect from<span class="subst">&#123;addr_from&#125;</span>&#x27;</span>)</span><br><span class="line">    header = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">    header = first + header</span><br><span class="line">    ver, num_method = struct.unpack(<span class="string">&quot;!BB&quot;</span>, header)</span><br><span class="line">    logging.info(<span class="string">f&#x27;ver == VERSION:<span class="subst">&#123;ver == VERSION&#125;</span>&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;num_method = %d&#x27;</span> % num_method)</span><br><span class="line">    methods = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_method):</span><br><span class="line">        methods.append(ord(<span class="keyword">await</span> reader.read(<span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">in</span> methods:<span class="comment">#无需认证</span></span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment">#回应一个数据包，包括协议版本号，指定认证方法</span></span><br><span class="line">    writer.write(struct.pack(<span class="string">&quot;!BB&quot;</span>, VERSION, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    request = <span class="keyword">await</span> reader.read(<span class="number">4</span>)</span><br><span class="line">    ver, cmd, rsv, atype = struct.unpack(<span class="string">&quot;!BBBB&quot;</span>, request)</span><br><span class="line">    <span class="keyword">assert</span> ver == VERSION</span><br><span class="line">    <span class="comment">#ipv4</span></span><br><span class="line">    <span class="keyword">if</span> atype == <span class="number">1</span>:</span><br><span class="line">        address = socket.inet_ntoa(<span class="keyword">await</span> reader.read(<span class="number">4</span>))</span><br><span class="line">    <span class="comment">#域名</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">3</span>:</span><br><span class="line">        domain_length = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">        address = <span class="keyword">await</span> reader.read(domain_length[<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#ipv6</span></span><br><span class="line">    <span class="keyword">elif</span> atype == <span class="number">4</span>:</span><br><span class="line">        address = socket.inet_ntop(socket.AF_INET6, <span class="keyword">await</span> reader.read(<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        writer.close()</span><br><span class="line">        writer.wait_closed()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    port = struct.unpack(<span class="string">&#x27;!H&#x27;</span>, <span class="keyword">await</span> reader.read(<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="number">1</span>:</span><br><span class="line">            reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(address,port[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            writer.close()</span><br><span class="line">            writer.wait_closed()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">        logging.error(error)</span><br><span class="line">    reply = struct.pack(<span class="string">&quot;!BBBBIH&quot;</span>, VERSION, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    writer.write(reply)</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#第一个字节为0表示成功代理</span></span><br><span class="line">    <span class="keyword">if</span> cmd == <span class="number">1</span> <span class="keyword">and</span> reply[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">        tasks = [read_trans(reader, writer_remote), write_trans(reader_remote, writer)]</span><br><span class="line">        <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">read_trans</span>(<span class="params">reader, writer_remote</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer_remote.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer_remote.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">write_trans</span>(<span class="params">reader_remote, writer</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> reader_remote.read(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            logging.info(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        writer.write(data)</span><br><span class="line">        <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">httptunnel</span>(<span class="params">first, reader, writer</span>):</span></span><br><span class="line">    http_connect = (<span class="keyword">await</span> reader.read(<span class="number">1024</span>))</span><br><span class="line">    http_connect = (first + http_connect).decode()</span><br><span class="line"></span><br><span class="line">    logging.info(http_connect)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(http_connect[i] != <span class="string">&#x27;:&#x27;</span>): </span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    domain_name = http_connect[<span class="number">8</span> : i]</span><br><span class="line">    j = i</span><br><span class="line">    <span class="keyword">while</span>(http_connect[j] != <span class="string">&#x27; &#x27;</span>):</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">    port = http_connect[i + <span class="number">1</span> : j]</span><br><span class="line">    </span><br><span class="line">    logging.info(<span class="string">&#x27;domain_name:%s &#x27;</span> % domain_name)</span><br><span class="line">    logging.info(<span class="string">&#x27;port:%s&#x27;</span> % port)</span><br><span class="line">    reply = <span class="string">&#x27;HTTP/1.1 200 OK\r\n\r\n&#x27;</span></span><br><span class="line">    writer.write(reply.encode())</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line">    reader_remote,writer_remote = <span class="keyword">await</span> asyncio.open_connection(domain_name,port)</span><br><span class="line">    tasks = [read_trans(reader, writer_remote), write_trans(reader_remote, writer)]</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">reader, writer</span>):</span></span><br><span class="line">    first = <span class="keyword">await</span> reader.read(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span>(first == <span class="string">b&#x27;\x05&#x27;</span>):</span><br><span class="line">        <span class="keyword">await</span> socks5(first, reader, writer)</span><br><span class="line">    <span class="keyword">elif</span>(first == <span class="string">b&#x27;C&#x27;</span>):</span><br><span class="line">        <span class="keyword">await</span> httptunnel(first, reader, writer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    server = <span class="keyword">await</span> asyncio.start_server(test, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10086</span>)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> server:</span><br><span class="line">        <span class="keyword">await</span> server.serve_forever()</span><br><span class="line">        </span><br><span class="line">asyncio.run(main())</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="代码说明（可选）"><a href="#代码说明（可选）" class="headerlink" title="代码说明（可选）"></a>代码说明（可选）</h2><p>源代码中不要出现大段的说明注释，如果需要可以可以在本节中加上说明。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/16/trie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/16/trie/" class="post-title-link" itemprop="url">tire树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-16 17:31:31" itemprop="dateCreated datePublished" datetime="2020-09-16T17:31:31+08:00">2020-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-10 11:25:08" itemprop="dateModified" datetime="2020-11-10T11:25:08+08:00">2020-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="comment">//son表示子节点，这里仅考虑26个小写字母。</span></span><br><span class="line"><span class="keyword">int</span> son[N][<span class="number">26</span>], cnt[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">char</span> str[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p  = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; str[i]; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		<span class="keyword">if</span>(!son[p][u]) son[p][u] = ++ idx;</span><br><span class="line">        p = son[p][u];</span><br><span class="line">    &#125;</span><br><span class="line">    cnt[p] ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">char</span> str[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; str[i]; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="keyword">int</span> u = str[i] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!son[p][u]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        p = son[p][u];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cnt[p];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/15/kmp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/15/kmp/" class="post-title-link" itemprop="url">kmp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-15 18:02:25" itemprop="dateCreated datePublished" datetime="2020-09-15T18:02:25+08:00">2020-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-10 11:23:55" itemprop="dateModified" datetime="2020-11-10T11:23:55+08:00">2020-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>, M = <span class="number">10010</span>;</span><br><span class="line"><span class="keyword">int</span> ne[N];</span><br><span class="line"><span class="keyword">char</span> n[N], p[M];<span class="comment">//n是字符串，p是模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//求next过程，字符串下标从1开始</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>, j =<span class="number">0</span>; i &lt;= <span class="keyword">sizeof</span>(p); i ++ ) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (j &amp;&amp; p[i] != p[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">    <span class="keyword">if</span>(p[i] == p[j + <span class="number">1</span>]) j ++;</span><br><span class="line">    ne[i] = j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//匹配过程,字符串下标从1开始</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= <span class="keyword">sizeof</span>(n); i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(j &amp;&amp; s[i] != p[j + <span class="number">1</span>]) j = ne[j];</span><br><span class="line">    <span class="keyword">if</span>(s[i] == p[j + <span class="number">1</span>]) j ++;</span><br><span class="line">    <span class="keyword">if</span>(j == <span class="keyword">sizeof</span>(n))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//匹配成功</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/15/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">计算机基础知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-15 14:54:38" itemprop="dateCreated datePublished" datetime="2020-09-15T14:54:38+08:00">2020-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-10 11:24:10" itemprop="dateModified" datetime="2020-11-10T11:24:10+08:00">2020-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>字：计算机一次存取、加工、传送的数据长度称为字</p>
<p>字长：计算机每个字所包含的位数称为字长</p>
<h2 id="ROM"><a href="#ROM" class="headerlink" title="ROM"></a>ROM</h2><p>掩膜只读存储器（Mask ROM）：掉电后依然存在，可靠性高。缺点是信息只能一次写入（在制造的过程中），不灵活</p>
<p>可编程只读存储器（PROM）：允许用户通过专用的色号被一次性写入自己所需要的东西，一般只可编程一次</p>
<p>可编程可擦除只读存储器（EPROM）：可读可写，用紫外线或脉冲电流先将原有的信息擦除，然后重新写入</p>
<p>电可擦除可编程只读存储器（EEPROM）：随时可以写入而无需擦除原先内容</p>
<p>快擦除读写存储器（Flash）：闪存，广泛用于制作各种移动存储器，如U盘以及存储卡</p>
<p>严格意义上：机械硬盘不属于ROM</p>
<p>固态硬盘和U盘属于ROM</p>
<h2 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h2><p>SRAM：静态随机存储器，利用双稳态触发器来存储信息，即使信息被读出后，它仍保持其原状态而不需要再生（非破坏性读出）。SRAM存取速度快，但是集成度低，功耗大，价格昂贵（价格是DRAM的几十倍），一般用来组成高速缓冲存储器。</p>
<p>DRAM：动态随机存储器是利用存储元电路中的栅极电容上的电荷来存储信息的，电容上的电荷一般只能维持1-2ms，即使电源不断电，信息也会自动消失，因此每隔一段时间需要刷新。</p>
<p>打开任务管理器即可看到L1、L2、L3缓存</p>
<h2 id="机械硬盘"><a href="#机械硬盘" class="headerlink" title="机械硬盘"></a>机械硬盘</h2><p>HDD，数据通过离磁性表面很近的磁头由电磁流来改变极性的方式被写入到磁盘上</p>
<p>接口：一种是IDE，一种是SATA，现在大多数都是SATA</p>
<p>固态硬盘接口：市面上销售的大多是m.2接口和sata接口</p>
<h2 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h2><p>基本输入输出系统，预安装在个人电脑的主板上，是个人电脑启动时加载的第一个软件。现在，BIOS的作用是初始化和测试<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%A1%AC%E9%AB%94">硬件</a>组件，以及从大容量存储设备（如硬盘）加载<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%95%9F%E5%8B%95%E7%A8%8B%E5%BC%8F">引导程序</a>，并由<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%95%9F%E5%8B%95%E7%A8%8B%E5%BC%8F">引导程序</a>加载操作系统。现在BIOS大多存储在flash芯片上。</p>
<p>以前BIOS存储在CMOS中，没电信息就会丢失。</p>
<p>CMOS中存储的内容掉电就会丢失，主板上通常有一块电池给CMOS供电。电脑关机后，过段时间再开机，发现时间依然是正确的，这就是这快电池在为时钟模块供电</p>
<h2 id="大端法-小端法"><a href="#大端法-小端法" class="headerlink" title="大端法/小端法"></a>大端法/小端法</h2><p>假设一个int型变量x的地址为0x100,那么x的4个字节将被存储在内存的0x100,0x101,0x102,0x103的位置。</p>
<p>字节序即为多字节对象在内存中的字节顺序</p>
<p>大端法：</p>
<p>最高有效字节在最前面的方式称为大端法，假设x的值为0x12345678。对于大端法的机器来说</p>
<p>0x100:12    0x101:34    0x102:56    0x103:78</p>
<p>小端法：</p>
<p>0x100:78    0x101:56    0x102:34    0x103:12</p>
<h2 id="括弧匹配"><a href="#括弧匹配" class="headerlink" title="括弧匹配"></a>括弧匹配</h2><p>1、任意前缀中，左括号数量大于右括号数量</p>
<p>2、左右括号数量相等</p>
<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><p>next[i] :在str[1~i]中，前缀和后缀相等的最长子串的长度</p>
<h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><p>1s可以算10的7次方到10的8次方次</p>
<h2 id="电脑开机过程"><a href="#电脑开机过程" class="headerlink" title="电脑开机过程"></a>电脑开机过程</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/13/%E6%95%B0%E7%BB%84%E6%A8%A1%E6%8B%9F%E9%93%BE%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zrf">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/13/%E6%95%B0%E7%BB%84%E6%A8%A1%E6%8B%9F%E9%93%BE%E8%A1%A8/" class="post-title-link" itemprop="url">数组模拟单链表</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-13 22:39:09" itemprop="dateCreated datePublished" datetime="2020-09-13T22:39:09+08:00">2020-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-10 11:24:19" itemprop="dateModified" datetime="2020-11-10T11:24:19+08:00">2020-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="数组模拟单链表"><a href="#数组模拟单链表" class="headerlink" title="数组模拟单链表"></a>数组模拟单链表</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">int</span> e[N], ne[N], idx, head;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    head = <span class="number">-1</span>;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//往链表头部插入元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert_head</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = x;<span class="comment">//首先将元素的值保存起来</span></span><br><span class="line">    ne[idx] = head;</span><br><span class="line">    head = idx;</span><br><span class="line">    idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在k位置的后面插入x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = x;</span><br><span class="line">    ne[idx] = ne[k];</span><br><span class="line">    ne[k] = idx;</span><br><span class="line">    idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//移除k位置后面的x元素</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ne[k] = ne[ne[k]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//移除头节点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove_head</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    head = ne[head];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数组模拟双链表"><a href="#数组模拟双链表" class="headerlink" title="数组模拟双链表"></a>数组模拟双链表</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> idx, l[N], r[N], e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    r[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在a的右边插入一个数x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert_right</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> x)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = x;</span><br><span class="line">    r[idx] = r[a];</span><br><span class="line">    l[idx] = a;</span><br><span class="line">    l[r[a]] = idx;</span><br><span class="line">    r[a] = idx;</span><br><span class="line">    idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在a的左边插入一个数x</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert_left</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    insert_right(l[a], x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//删除节点a</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    l[r[a]] = l[a];</span><br><span class="line">    r[l[a]] = r[a];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数组模拟栈、队列"><a href="#数组模拟栈、队列" class="headerlink" title="数组模拟栈、队列"></a>数组模拟栈、队列</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="comment">/************栈*************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//tt表示栈顶</span></span><br><span class="line"><span class="keyword">int</span> stk[N], tt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//进栈</span></span><br><span class="line">stk[++ tt] = x;</span><br><span class="line"></span><br><span class="line"><span class="comment">//出栈</span></span><br><span class="line">tt --;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断栈是否为空</span></span><br><span class="line"><span class="keyword">if</span>(tt &gt; <span class="number">0</span>) 不空</span><br><span class="line"><span class="keyword">else</span> 空</span><br><span class="line">    </span><br><span class="line"><span class="comment">//栈顶元素</span></span><br><span class="line">stk[tt];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********队列***************/</span></span><br><span class="line"><span class="comment">//hh表示队头，tt表示队尾，在队尾插入元素，在队头弹出元素</span></span><br><span class="line"><span class="keyword">int</span> q[N], hh, tt = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入</span></span><br><span class="line">q[++ tt] = x;</span><br><span class="line"><span class="comment">//弹出</span></span><br><span class="line">hh ++;</span><br><span class="line"><span class="comment">//判断是否为空</span></span><br><span class="line"><span class="keyword">if</span>(hh &lt;= tt)非空</span><br><span class="line"><span class="keyword">else</span> 空</span><br><span class="line"><span class="comment">//取出队头元素</span></span><br><span class="line">q[hh];</span><br><span class="line"><span class="comment">//取出队尾元素</span></span><br><span class="line">q[tt];</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zrf</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zrf</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
